
  <!DOCTYPE html>
  <html>
    <head>
      <title>schema-validator.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="..\..\..\assets\source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="..\..\..\assets\source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="..\..\..\index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">app\middleware\schema-validator.ts</td><td class="">100.00%</td><td class="">80%</td><td class="">46</td><td class="">46</td><td class="">0</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">import { NextFunction, Request, Response } from &#x27;express&#x27;;
import { ZodError } from &#x27;schema&#x27;;
import ServerError from &#x27;../helpers/errors/server.error&#x27;;
import ValidationError from &#x27;../helpers/errors/validation.error&#x27;;
import type { ZodType, ZodTypeDef } from &#x27;schema&#x27;;

export function validateSchema(
  schema: ZodType&lt;unknown, ZodTypeDef, unknown&gt;,
  canal: &#x27;body&#x27; | &#x27;params&#x27; | &#x27;query&#x27;,
) {
  return async function (request: Request, _res: Response, next: NextFunction) {
    if (!schema) return next(new ServerError(&#x27;No schema provided&#x27;));
    try {
      await schema.parseAsync(request[canal]);
      next();
    } catch (error) {
      if (error instanceof ZodError) {
        const fieldErros: Record&lt;string, string&gt; = {};
        // We don&#x27;t use ZodError formErrors accessor
        // because we can&#x27;t associate the error with the field
        error.issues.map((e) =&gt; {
          return (fieldErros[e.path[0]] = e.message);
        });
        next(new ValidationError(&#x27;Schema is not valid&#x27;, fieldErros));
      }
      next(error);
    }
  };
}

// export default (
//   schema: ZodType&lt;any, ZodTypeDef, any&gt;,
//   canal: &#x27;body&#x27; | &#x27;params&#x27; | &#x27;query&#x27;,
// ) =&gt;
//   async (request: Request, _res: Response, next: NextFunction) =&gt; {
//     if (!schema) return next(new ServerError(&#x27;No schema provided&#x27;));
//     try {
//       await schema.parseAsync(request[canal]);
//       next();
//     } catch (error) {
//       if (error instanceof ZodError) {
//         const fieldErros: Record&lt;string, string&gt; = {};
//         // We don&#x27;t use ZodError formErrors accessor
//         // because we can&#x27;t associate the error with the field
//         error.issues.map((e) =&gt; {
//           return (fieldErros[e.path[0]] = e.message);
//         });
//         next(new ValidationError(&#x27;Schema is not valid&#x27;, fieldErros));
//       }
//       next(error);
//     }
//   };
</textarea><pre id="annotations" style="display:none">[]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Fri, 05 Jan 2024 16:47:28 GMT</p>
    </body>
  </html>
  